<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Orgmode利用ox-pandoc导出hugo博客的workflow // Yuantops&#39; Blog</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta property="og:title" content="Orgmode利用ox-pandoc导出hugo博客的workflow" />
<meta property="og:description" content="我用orgmode &#43; hugo写博客的个人实践，希望对orgmode中文用户/hugo blogger有所启发。" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://blog.yuantops.com/tech/emacs-orgmode-hugo-with-oxpandoc/" />


    <link href="" rel="alternate" type="application/rss+xml" title="Yuantops&#39; Blog" />
    <link rel="shortcut icon" href="/favicon.ico">

    <link href="https://blog.yuantops.com/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="https://blog.yuantops.com/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://blog.yuantops.com/css/style.css">

    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <meta name="description" content="我用orgmode &#43; hugo写博客的个人实践，希望对orgmode中文用户/hugo blogger有所启发。">
    <meta name="keywords" content="orgmode写博客,ox-pandoc导出博客,">
    <meta name="author" content="">

    <meta name="generator" content="Hugo 0.50" />
</head>


<body>
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="https://blog.yuantops.com/">Yuantops&#39; Blog</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="/archives/">Archives</a>
                
                <a class="main-nav-link" href="/about/">About</a>
                
                <a class="main-nav-link" href="/index.xml">RSS</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>

    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">Orgmode利用ox-pandoc导出hugo博客的workflow</h1>
        </header>
        
        <div class="article-meta">
            <a href="/tech/emacs-orgmode-hugo-with-oxpandoc/" class="article-date">
                <time datetime='2017-12-10T13:16:22.000&#43;00:00' itemprop="datePublished">2017-12-10</time>
            </a>
            
            
            <div class="post-categories">
                <div class="article-category">
                    
                    
                    <a class="article-category-link" href="https://blog.yuantops.com//categories/tech">Tech</a>
                    
                </div>
		
		<div class="article-category">
	      	  264字, 约2分钟读完
		</div>
	    

            </div>
            

	    
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            

<p>使用Emacs有一年多了吧，终于开始体会到它的强大。这段盘旋上升的磨合期，值得写几篇文章记录一下。这篇博客就是我用orgmode + hugo写博客的个人实践，希望对orgmode中文用户/hugo blogger有所启发。</p>

<h1 id="之前的workflow">之前的workflow</h1>

<p>自从转到hugo后，我发博客的workflow是这样的：</p>

<ol>
<li>在org文件里添加内容</li>
<li>按下 <code>C-c C-e</code> （export命令），再按 <code>C-s</code> (只导出当前subtree)，再按 <code>m o</code>
(导出格式markdown)，生成markdown 内容</li>
<li>把markdown内容保存到 <code>hugo/content/</code> 目录，手动加上文件头(front matter)</li>
<li>本地部署hugo server，检查效果。无误则运行部署脚本 <code>deploy.sh</code> push到github仓库的 <code>hugo</code> 分支</li>
<li>github上我给 <code>hugo</code> 分支加了webhook，会触发构建，部署生成的html内容到 <code>gh-pages</code> 分支</li>
</ol>

<p>这段流程一直还凑合，直到我的博客里出现表格：org导出的markdown表格会变成一坨翔，我要在第4步浪费很多时间人肉调整格式。</p>

<p>怒google一把，发现是<a href="http://orgmode.org/manual/Markdown-export.html">org markdown官方导出引擎不支持table</a>导致的:</p>

<pre><code>Since md is built on top of the HTML back-end, any Org constructs not supported by Markdown, such as tables, the underlying html back-end (see HTML export) converts them.
</code></pre>

<p>搜索时我发现有网友提到 <code>ox-pandoc</code>
，点进去github主页看了看，pandoc和orgmode的天作之合啊。pandoc对表格的支持无懈可击，还有啥好说，马上就决定是它了！</p>

<h1 id="emacs安装ox-pandoc">Emacs安装ox-pandoc</h1>

<h2 id="安装pandoc">安装pandoc</h2>

<p>因为ox-pandoc是对pandoc的调用封装，所以首先得装上pandoc。pandoc可能是haskell语言最著名的作品了，支持非常多种文件格式的互转，极其强大。官网有安装文档，不再赘述。
确认已装好:</p>

<pre><code class="language-shell">pandoc -v
</code></pre>

<h2 id="安装ox-pandoc">安装ox-pandoc</h2>

<ol>
<li><p>官方github: <a href="https://github.com/kawabata/ox-pandoc">ox-pandoc主页</a></p></li>

<li><p><code>init.el</code> 加上elpa源:</p>

<pre><code class="language-commonlisp">(setq package-archives
   '((&quot;melpa&quot; . &quot;http://melpa.milkbox.net/packages/&quot;)))
</code></pre></li>

<li><p>添加hook:</p>

<pre><code class="language-commonlisp">(with-eval-after-load 'ox
(require 'ox-pandoc))
</code></pre></li>

<li><p>删掉旧的markdown导出：</p>

<p>找到类似配置，删掉</p>

<pre><code class="language-commonlisp">'(require 'ox-md nil t)
</code></pre></li>

<li><p>重启emacs</p>

<p>打开org文件，按下 <code>C-c C-e</code> ，弹出的orgmode export dispather窗口中应该出现了 <code>p</code>
开头的很多选项，而且原来 <code>m</code> 开头的markdown选项不见了。</p></li>
</ol>

<h2 id="配置ox-pandoc-参数">配置ox-pandoc 参数</h2>

<p>ox-pandoc的导出选项可以配置在文档头部，就像org原生的导出选项配置一样。将官方wiki上关于文档的描述翻译如下：</p>

<pre><code>Value nil overrides preceding option setting.
nil会覆盖之前为某个选项设置的值。

Value t means only specify option, but not its value.
t会打开某个选项的开关，而不会设置它的值。

Options are delimited by space.
多个选项间用空格分隔。

#+PANDOC_OPTIONS: can be specified multiple times. 
#+PANDOC_OPTIONS: 能多次使用。

If you want to specify the option value which include space character, quote entire option-value pair.
如果某个选项的值包含空格，那么要将“选项-值”都放到引号里。

Specifying Multiple values to single options by using colon-sparated lists.
给一个选项指定多个值，要使用逗号分隔的列表。
</code></pre>

<p>例如，ox-pandoc给导出文档添加目录:</p>

<pre><code>#+PANDOC_OPTIONS: toc-depth:3
#+PANDOC_OPTIONS: toc:t
</code></pre>

<p>再例如，使用ox-pandoc <code>C-c C-e p l</code> 导出latex文档，如果中文不能正常显示，需要加上这两行：</p>

<pre><code>#+PANDOC_OPTIONS: pdf-engine:xelatex
#+PANDOC_OPTIONS: &quot;variable:CJKmainfont:Noto Sans CJK SC&quot;
</code></pre>

<p><em>xelatex</em> 是latex的一种处理引擎，对中文支持不错。如何安装xelatex，这里不赘述。</p>

<p><em>Noto Sans CJK SC</em> 是我系统(Ubuntu)上安装的中文字体。用下面的命令查看安装了哪些中文字体:</p>

<pre><code>fc-list :lang=zh
# 命令output: 字体名是两个冒号之间的、第一个逗号前的内容
# /usr/share/fonts/opentype/noto/NotoSansCJK-Light.ttc: Noto Sans CJK SC,Noto Sans CJK SC Light:style=Light,Regular
</code></pre>

<h2 id="配置hugo-front-matter的snippet">配置hugo front-matter的snippet</h2>

<p>如果你像我一样正在用Emacs的 <code>yasnippet</code>
包，可以参考我的做法，迅速添加带标题和日期的hugo文件头。这里参考了：<a href="http://whyarethingsthewaytheyare.com/setting-up-the-blog/#workflow">setting-up-the-blog</a>
。</p>

<p>添加yasnippet模板文件，然后在org的subtree开头按下 <code>hmatter [TAB]</code> 即可。</p>

<pre><code># key: hmatter
# name: hugo-blog-matter
# --
#+BEGIN_SRC xxx
+++
title = &quot;`(cdr (assoc &quot;ITEM&quot; (org-entry-properties)))`&quot;
date = &quot;`(format-time-string &quot;%Y-%m-%dT%H:%M:%S&quot;)`Z&quot;
Categories = [&quot;Tech&quot;]
Tags = [&quot;&quot;]
Description = &quot;&quot;
+++
</code></pre>

<h1 id="现在的workflow">现在的workflow</h1>

<p>基本和之前的一样，但是现在导出按键顺序变成了</p>

<ol>
<li><code>hmatter [TAB]</code> 插入front-matter，</li>
<li><code>C-c C-e</code> export命令，</li>
<li><code>C-s</code> 只导出当前subtree，</li>
<li><code>p g</code> 用pandoc导出github风格的markdown.</li>
</ol>

<p>现在导出的格式堪称完美，达到了我的预期。</p>

<p>其实，最理想的workflow应该是写一个function把上述几步串起来，而且已经有人这么做了。等我哪天开始学elisp了，再来自己造轮子吧！</p>

        </div>

        
        
        <div class="article-toc" style="display:none;">
            <h3>Contents</h3>
            <nav id="TableOfContents">
<ul>
<li><a href="#之前的workflow">之前的workflow</a></li>
<li><a href="#emacs安装ox-pandoc">Emacs安装ox-pandoc</a>
<ul>
<li><a href="#安装pandoc">安装pandoc</a></li>
<li><a href="#安装ox-pandoc">安装ox-pandoc</a></li>
<li><a href="#配置ox-pandoc-参数">配置ox-pandoc 参数</a></li>
<li><a href="#配置hugo-front-matter的snippet">配置hugo front-matter的snippet</a></li>
</ul></li>
<li><a href="#现在的workflow">现在的workflow</a></li>
</ul>
</nav>
        </div>
        
        

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin="anonymous"></script>
        <script>
            (function() {
                var $toc = $('#TableOfContents');
                if ($toc.length > 0) {
                    var $window = $(window);

                    function onScroll(){
                        var currentScroll = $window.scrollTop();
                        var h = $('.article-entry h1, .article-entry h2, .article-entry h3, .article-entry h4, .article-entry h5, .article-entry h6');
                        var id = "";
                        h.each(function (i, e) {
                            e = $(e);
                            if (e.offset().top - 10 <= currentScroll) {
                                id = e.attr('id');
                            }
                        });
                        var active = $toc.find('a.active');
                        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

                        active.each(function (i, e) {
                            $(e).removeClass('active').siblings('ul').hide();
                        });
                        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                            $(e).children('a').addClass('active').siblings('ul').show();
                        });
                    }

                    $window.on('scroll', onScroll);
                    $(document).ready(function() {
                        $toc.find('a').parent('li').find('ul').hide();
                        onScroll();
                        document.getElementsByClassName('article-toc')[0].style.display = '';
                    });
                }
            })();
        </script>
        


        
	
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://blog.yuantops.com//tags/emacs">Emacs
                    </a>
                </li>
                
            </ul>
        </footer>
        
	
    </div>
    <nav id="article-nav">
    
    <a href="/tech/emacs-config-go-dev-environ/" id="article-nav-newer" class="article-nav-link-wrap">
        <div class="article-nav-title"><span>&lt;</span>&nbsp;
            Emacs Golang开发环境配置指南
        </div>
    </a>
    
    
    <a href="/tech/emacs-macos-chn-font-conf/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">Emacs macOS配置中文字体&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>
</article>

        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2012-2019 @yuantops&nbsp; </br>
            Proudly powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/carsonip/hugo-theme-minos">Minos</a>
        </div>
    </div>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-57420914-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css" integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha256-ExtbCSBuYA7kq1Pz362ibde9nnsHYPt6JxuxYeZbU+c=" crossorigin="anonymous"></script>
        <script>renderMathInElement(document.body);</script>
    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
</footer>

</div>
</body>
</html>
